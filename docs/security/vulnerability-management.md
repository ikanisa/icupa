# Vulnerability Management & Exception Process

This document defines how ICUPA reviews, remediates, and (when necessary) temporarily suppresses security findings from tooling such as `pnpm audit`, Trivy, and CodeQL.

## Standard Workflow

1. **Detection** – Automated jobs in GitHub Actions run on every push and pull request:
   - `Dependency Audit` executes `pnpm audit` with a failure gate on critical findings.
   - `Container Security Scan` runs Trivy against every published application image.
   - `CodeQL` evaluates the TypeScript/JavaScript codebase for common classes of bugs.
2. **Triage** – The on-call security reviewer assigns a severity (Critical/High/Medium/Low) and confirms exploitability within the ICUPA deployment context.
3. **Remediation** – Owners of the affected package or service must ship a fix within:
   - 24 hours for Critical
   - 3 days for High
   - 14 days for Medium
   - 30 days for Low

## Suppression Policy

Suppressions are allowed only when **all** of the following are true:

- A vendor patch is not yet available or applying it would break production.
- A compensating control is documented (for example: WAF rule, network isolation, feature toggle).
- An explicit expiration date is set (maximum 30 days).

### How to Suppress a Finding

1. Create an issue labeled `security-suppression` describing:
   - Vulnerability ID (e.g. CVE, GHSA, CodeQL rule).
   - Affected component (package, container image, file path).
   - Business justification and compensating controls.
   - Expiration date and owner responsible for removal.
2. Add the issue number to the relevant ignore mechanism:
   - **pnpm audit**: `audit-resolutions.json` entry referencing the issue ID and expiry.
   - **Trivy**: Add to `security/trivy.ignore` with a `# expires: YYYY-MM-DD | issue: <id>` comment.
   - **CodeQL**: Add a `// CODEQL[<rule>] allow until YYYY-MM-DD see issue <id>` inline suppression comment.
3. Update `docs/security/vulnerability-management.md` in the `Active Suppressions` table.
4. Create a PR with the suppression, tagging `@icupa/security` for approval.

### Active Suppressions

| Vulnerability | Component | Issue | Expires | Mitigation |
| ------------- | --------- | ----- | ------- | ---------- |
| _None_ | – | – | – | – |

## Review & Expiry

A scheduled GitHub Action checks expiry dates weekly. If a suppression has lapsed, the build fails until the entry is removed or renewed through security review.

## Related References

- [SECURITY.md](../../SECURITY.md)
- [.github/workflows/dependency-audit.yml](../../.github/workflows/dependency-audit.yml)
- [.github/workflows/container-scan.yml](../../.github/workflows/container-scan.yml)
- [.github/workflows/codeql.yml](../../.github/workflows/codeql.yml)
